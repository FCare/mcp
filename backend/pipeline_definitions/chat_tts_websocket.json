{
  "id": "chat_tts_websocket",
  "name": "Pipeline Chat TTS WebSocket",
  "description": "Pipeline de chat avec streaming texte ET génération audio via TTS",
  "version": "1.0.0",
  "capabilities": {
    "modalities": {
      "input": ["audio", "text", "image"],
      "output": ["audio", "text"],
      "processing": ["speech-to-text", "conversation", "llm", "vision", "text-to-speech", "function_calling"]
    },
    "features": ["streaming", "conversational", "voice", "real-time", "vision", "tools"],
    "models": ["kyutai-asr", "qwen3-vl-8b-instruct", "kyutai-tts"]
  },
  "step_instances": [
    {
      "instance_id": "system_prompt",
      "step_definition": "System Prompt Step",
      "config_overrides": {
        "prompt_template": "Tu es un assistant virtuel intelligent utilisant Qwen3 VL 8B Instruct. Tu réponds de manière concise et claire en français. Tu t'adresses à l'utilisateur en language oral, donc uniquement avec des caracteres alphanumeriques. Tu ecris les mots en entier, aucune abbréviations. Quand tu dois donner une liste, donne la sous la forme d'une liste sépraée par des virgules, pas sous forme de liste a puces, ni sous forme de liste a tiret, ni sous forme de liste numérotée."
      }
    },
    {
      "instance_id": "websocket_server",
      "step_definition": "websocket_server",
      "config_overrides": {
        "port": 8769,
        "mode": "audio_text_to_text_audio",
        "audio_format": "pcm16",
        "sample_rate": 24000
      }
    },
    {
      "instance_id": "tool_registry",
      "step_definition": "Tool Registry Step",
      "config_overrides": {
        "expected_tools": ["weather_tool"],
        "registration_timeout": 5.0,
        "llm_step_name": "openai_chat"
      }
    },
    {
      "instance_id": "weather_tool",
      "step_definition": "Weather Tool Step",
      "config_overrides": {
        "user_permissions": {
          "allowed_users": [],
          "denied_users": []
        }
      }
    },
    {
      "instance_id": "asr_step",
      "step_definition": "Kyutai ASR Step",
      "config_overrides": {
        "host": "unmute-transcript.caronboulme.fr",
        "port": 443
      }
    },
    {
      "instance_id": "websocket_duplicator",
      "step_definition": "Duplicator Step",
      "config_overrides": {}
    },
    {
      "instance_id": "asr_duplicator",
      "step_definition": "Duplicator Step",
      "config_overrides": {}
    },
    {
      "instance_id": "openai_chat",
      "step_definition": "OpenAI Chat Step",
      "config_overrides": {}
    },
    {
      "instance_id": "duplicator",
      "step_definition": "Duplicator Step",
      "config_overrides": {}
    },
    {
      "instance_id": "sentence_normalizer",
      "step_definition": "Sentence Normalizer Step",
      "config_overrides": {
        "language_id": "fr"
      }
    },
    {
      "instance_id": "tts_step",
      "step_definition": "kyutai_tts",
      "config_overrides": {}
    },
    {
      "instance_id": "tool_registry_duplicator",
      "step_definition": "Duplicator Step",
      "config_overrides": {}
    }
  ],
  "connections": [
    {
      "from": "system_prompt",
      "to": "openai_chat"
    },
    {
      "from": "websocket_server",
      "to": "websocket_duplicator"
    },
    {
      "from": "websocket_duplicator",
      "to": ["asr_step", "openai_chat", "tool_registry"]
    },
    {
      "from": "tool_registry",
      "to": "tool_registry_duplicator"
    },
    {
      "from": "tool_registry_duplicator",
      "to": ["weather_tool", "openai_chat"]
    },
    {
      "from": "weather_tool",
      "to": "tool_registry"
    },
    {
      "from": "weather_tool",
      "to": "openai_chat"
    },
    {
      "from": "asr_step",
      "to": "asr_duplicator"
    },
    {
      "from": "asr_duplicator",
      "to": ["websocket_server", "openai_chat"]
    },
    {
      "from": "openai_chat",
      "to": "duplicator"
    },
    {
      "from": "duplicator",
      "to": ["websocket_server", "sentence_normalizer", "tts_step", "weather_tool"]
    },
    {
      "from": "sentence_normalizer",
      "to": "tts_step"
    },
    {
      "from": "tts_step",
      "to": "websocket_server"
    }
  ]
}